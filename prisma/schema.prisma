generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String
  role         String   @default("ADMIN")
  createdAt    DateTime @default(now())
}

model Client {
  id           String        @id @default(uuid())
  name         String
  phone        String
  email        String?
  notes        String?
  createdAt    DateTime      @default(now())
  appointments Appointment[]
}

model Service {
  id              String          @id @default(uuid())
  name            String
  description     String?
  category        String          @default("Cilios")
  active          Boolean         @default(true)
  createdAt       DateTime        @default(now())
  options         ServiceOption[]
}

model ServiceOption {
  id              String        @id @default(uuid())
  serviceId       String
  service         Service       @relation(fields: [serviceId], references: [id])
  type            String        // "APPLICATION" or "MAINTENANCE"
  durationMinutes Int
  priceCents      Int
  depositCents    Int           @default(0)
  active          Boolean       @default(true)
  createdAt       DateTime      @default(now())
  appointments    Appointment[]

  @@unique([serviceId, type])
}

model Staff {
  id           String         @id @default(uuid())
  name         String
  active       Boolean        @default(true)
  workingHours WorkingHours[]
  blocks       Block[]
  appointments Appointment[]
}

model WorkingHours {
  id        String @id @default(uuid())
  staffId   String
  staff     Staff  @relation(fields: [staffId], references: [id])
  weekday   Int    // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
  startTime String // Format HH:mm (e.g., "09:00")
  endTime   String // Format HH:mm (e.g., "18:00")
}

model Block {
  id      String   @id @default(uuid())
  staffId String
  staff   Staff    @relation(fields: [staffId], references: [id])
  startAt DateTime
  endAt   DateTime
  reason  String?
}



model Appointment {
  id              String            @id @default(uuid())
  clientId        String
  client          Client            @relation(fields: [clientId], references: [id])
  serviceOptionId String
  serviceOption   ServiceOption     @relation(fields: [serviceOptionId], references: [id])
  staffId         String
  staff           Staff             @relation(fields: [staffId], references: [id])
  startAt         DateTime
  endAt           DateTime
  status          String            @default("PENDING_PAYMENT")
  clientNotes     String?
  internalNotes   String?
  createdAt       DateTime          @default(now())
  payments        Payment[]
}



model Payment {
  id            String        @id @default(uuid())
  appointmentId String
  appointment   Appointment   @relation(fields: [appointmentId], references: [id])
  amountCents   Int
  method        String
  status        String @default("PENDING")
  provider      String?
  providerRef   String?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
}

model Settings {
  id                String @id @default(uuid())
  slotMinutes       Int    @default(15)
  bufferMinutes     Int    @default(10)
  minAdvanceMinutes Int    @default(120)
  timezone          String @default("America/Belem")
  salonName         String @default("Studio Josy Silva")
  salonAddress      String?
  salonPhone        String?
}
